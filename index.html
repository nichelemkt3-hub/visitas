<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ValidaÃ§Ã£o de Visita</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    button {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      margin-top: 10px;
    }
    img {
      max-width: 100%;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h2>ValidaÃ§Ã£o de Visita</h2>

<button onclick="capturarLocalizacao()">ğŸ“ Capturar LocalizaÃ§Ã£o</button>
<p id="localizacao"></p>

<button onclick="abrirCamera()">ğŸ“¸ Tirar Foto</button>
<input type="file" id="camera" accept="image/*" capture="environment" hidden>
<img id="preview">

<button onclick="enviar()">âœ… Confirmar Visita</button>
<p id="status"></p>

<script>
let latitude = null;
let longitude = null;
let fotoBase64 = null;

// ğŸ”´ COLE A URL DO SEU WEBAPP AQUI
const API_URL = "https://script.google.com/macros/s/AKfycbxdBLLYp6L2RCxTzf6DQmbD-eVsWVl9eSsl1SwAmmnzSfE9mM3drupSldnEfZxQA_jplA/exec";

function capturarLocalizacao() {
  navigator.geolocation.getCurrentPosition(pos => {
    latitude = pos.coords.latitude;
    longitude = pos.coords.longitude;
    document.getElementById("localizacao").innerText =
      `Latitude: ${latitude} | Longitude: ${longitude}`;
  }, err => {
    alert("Erro ao obter localizaÃ§Ã£o");
  });
}

function abrirCamera() {
  document.getElementById("camera").click();
}

document.getElementById("camera").addEventListener("change", e => {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    fotoBase64 = reader.result;
    document.getElementById("preview").src = fotoBase64;
  };
  reader.readAsDataURL(file);
});

function enviar() {
  if (!latitude || !longitude || !fotoBase64) {
    alert("Falta localizaÃ§Ã£o ou foto");
    return;
  }

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      lat: latitude,
      lng: longitude,
      fotoBase64: fotoBase64
    })
  })
  .then(r => r.json())
  .then(res => {
    if (res.codigo) {
      document.getElementById("status").innerText =
        "Visita confirmada! CÃ³digo: " + res.codigo;
    } else {
      document.getElementById("status").innerText =
        "Erro: " + res.erro;
    }
  })
  .catch(() => {
    document.getElementById("status").innerText =
      "Erro ao enviar dados";
  });
}
</script>

</body>
</html>
